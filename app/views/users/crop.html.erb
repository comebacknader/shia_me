<% provide(:title, "Change Profile Pic") %>

<% content_for(:head) do %>
 <%= stylesheet_link_tag "jquery.Jcrop" %>
 <%= javascript_include_tag "jquery.Jcrop.min" %>
 <script type="text/javascript" charset="utf-8">
 $(function() {
	$(".cropbox").Jcrop();
   	 onChange: update_crop,
   	 onSelect: update_crop,
   	 setSelect: [0, 0, 500, 500],
   	 aspectRatio: 1
    });	
 });

 function update_crop(coords) { 
  var ratio = <%= @user.avatar_geometry(:original).width %> / <%= @user.avatar_geometry(:large).width %>;
  $("#crop_x").val(Math.round(coords.x * ratio));
  $("#crop_y").val(Math.round(coords.y * ratio));
  $("#crop_w").val(Math.round(coords.w * ratio));
  $("#crop_h").val(Math.round(coords.h * ratio));
} 
  
 </script>

<% end %>

<%= render 'shared/userallbar' %>

<div class="container">
	
	<h1 class="user_pics_header">Crop Profile Pic</h1>
	
	<div class="admin_signup_box">
		
			<%= image_tag(@user.avatar(:large), class: "cropbox") %>
	
	
	<%= form_for @user do |f| %>
		<p><%= f.submit "Crop", :class => "admin_create" %></p>
		<% for attribute in [:crop_x, :crop_y, :crop_w, :crop_h] %>
		  <%= f.hidden_field attribute, :id => attribute %>
		<% end %>
	<% end %>
			
	</div>		
</div>